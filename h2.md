  # x) Lue ja vastaa lyhyesti kysymyksiin. Tässä alakohdassa x ei tällä kertaa tarvitse lukea artikkeleita kokonaan, ei tarvitse tiivistää niitä, eikä tehdä testejä koneella.
  
  ##   Selitä tuskan pyramidin idea 1-2 virkkeellä. Bianco 2013: Pyramid of Pain. (Katso eritoten pyramidin kuvaa.)
  
  ##   Selitä timanttimallin (Diamond Model) idea 1-2 virkkeellä. Tekijä esittelee sen aika juhlallisesti, voit myös etsiä yksinkertaisempia artikkeleita hakukoneella tai kelata suoraan timantin kuvaan. Caltagirone et al 2013: Diamond Model
  
  #  a) Apache log. Asenna Apache-weppipalvelin paikalliselle virtuaalikoneellesi. Surffaa palvelimellesi salaamattomalla HTTP-yhteydellä, http://localhost . Etsi omaa sivulataustasi vastaava lokirivi. Analysoi yksi tällainen lokirivi, eli selitä sen kaikki kohdat.

  $ sudo apt-get install apache2 = lataa apache2 palvelimen

  <img width="521" height="154" alt="image" src="https://github.com/user-attachments/assets/e4aa3e1b-dbbe-46c4-a10e-3da75c4ea11c" />

  $ sudo systemnctl start apache2 

  systemctl = system control, sillä voi pyörittää paljon muutakin kuin vain apache

  <img width="422" height="57" alt="image" src="https://github.com/user-attachments/assets/7d827b22-2ed5-49a3-ba4b-4b982ede37b2" />

  Navigoin Apachen logihakemistoon ja siihen syötin tail -F komennon

  -F flag = real time monitoring

  <img width="1093" height="214" alt="image" src="https://github.com/user-attachments/assets/10862f21-e177-41cc-b021-3cfa9b2a3586" />

  Rivin mille kohdistan analyysin:
  
  127.0.0.1 - - [31/Oct/2025:08:35:32 -0400] "GET /favicon.ico HTTP/1.1" 404 487 "http://localhost/" "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"


  
  #  b) Nmapped. Porttiskannaa oma weppipalvelimesi käyttäen localhost-osoitetta ja 'nmap -A' päällä. Selitä tulokset. (Pelkkä http-portti 80/tcp riittää)

  Tässä skannasin localhostia ja seuraavat tiedot tuli esiin:

  <img width="933" height="273" alt="image" src="https://github.com/user-attachments/assets/e1e4f8c3-11d0-4cfe-a968-2fe0618eb7c0" />

  tcp 80 protilla mikä on auki.

  
  
  #  c) Skriptit. Mitkä skriptit olivat automaattisesti päällä, kun käytit "-A" parametria? (Näkyy avoimien porttinumeroiden alta, http-blah, http-blöh...).

  Tämä poimittu suoraan nmap --h komennolla:

  -A flagi = Enable OS detection, eli tunnistaa käyttöjärjestelmän, sen version, (script scanning?) ja traceroute.

  <img width="628" height="22" alt="image" src="https://github.com/user-attachments/assets/7019feb3-273a-48e8-9428-eb801537252c" />


  
  #  d) Jäljet lokissa. Etsi weppipalvelimen lokeista jäljet porttiskannauksesta (NSE eli Nmap Scripting Engine -skripteistä skannauksessa). Löydätkö sanan "nmap" isolla tai pienellä? Selitä osumat. Millaisilla hauilla tai säännöillä voisit tunnistaa porttiskannauksen jostain muusta lokista, jos se on niin laaja, että et pysty lukemaan itse kaikkia rivejä?

Tässä koitin taas tails komentoa, mutta lisäsin -w flagin oletuksena että se suodattaa logihakemiston, näin ei käynyt.

<img width="398" height="76" alt="image" src="https://github.com/user-attachments/assets/c35f1733-3bbf-491b-98cd-229f430986b3" />

Sitten koitin grep ja cat komentoa muutamalla eri tavalla, ei onnistunut 

<img width="463" height="382" alt="image" src="https://github.com/user-attachments/assets/48a1649a-dc5c-4240-8e0f-e78e57c23eef" />

Tässä vaiheessa päätin kysyä tekoälyltä neuvoa, se sanoi että multa puuttuu hakemisto mistä greppi hakis sitä.

Hakemiston lisäyksen jälkeen komento suoritettiin ja antoi tehtävänannon mukaiset tulokset.

<img width="1427" height="340" alt="image" src="https://github.com/user-attachments/assets/d3622bba-1f5f-4928-a026-739d736f67d9" />


  
  
  #  e) Wire sharking. Sieppaa verkkoliikenne porttiskannatessa Wiresharkilla. Huomaa, että localhost käyttää "Loopback adapter" eli "lo". Tallenna pcap. Etsi kohdat, joilla on sana "nmap" ja kommentoi niitä. Jokaisen paketin jokaista kohtaa ei tarvitse analysoida, yleisempi tarkastelu riittää.

  <img width="1739" height="603" alt="image" src="https://github.com/user-attachments/assets/a190b65f-5825-484b-ae5e-73fcd73893ce" />

  
  #  f) Net grep. Sieppaa verkkoliikenne 'ngrep' komennolla ja näytä kohdat, joissa on sana "nmap".
  
  Käynnistin ngrep komennon mikä näkyi terokarvisen.com vinkit osiossa.

  <img width="534" height="111" alt="image" src="https://github.com/user-attachments/assets/b2cf5f98-1bf2-4120-82a1-2beb86a96ac4" />

  Kun avasin firefoxin, outputtiin ilmestyi vain kasa # merkkejä.

  <img width="945" height="383" alt="image" src="https://github.com/user-attachments/assets/443e774c-7054-4c17-b484-4d0e9875b2bc" />

  Lähdin siitä sitten purkamaan mitä tarkoittaa ngrep ja mitä nuo flagit tarkoittavat.

  Selivtyksen jälkeen sain tietää, että tehtävänannon tarkoitus on käynnistää ngrep ja sitten sen jälkeen tehdä porttiskannaus localhostiin.

  Nmapin käynnistyksen jälkeen ngrep outputtiin ilmestyi seeuraavat rivit:

  <img width="964" height="822" alt="image" src="https://github.com/user-attachments/assets/1f18241e-d15b-4ecc-9f0f-d031bacb93d8" />

  Tossa oli paljon rivejä, mutta kaikki rivit mitkä ovat näytönkaappauksella ovat nmapista tulleita. 

  "
  
  #  g) Agentti. Vaihda nmap:n user-agent niin, että se näyttää tavalliselta weppiselaimelta.

Luin tämän dokumentaation nmap user agentista ( https://nmap.org/nsedoc/scripts/http-useragent-tester.html )

Lähdin testailemaan esimerkissä annettua komentia, ei toiminut.

<img width="915" height="188" alt="image" src="https://github.com/user-attachments/assets/35064955-366b-4085-aeba-e8d8c4af22e0" />

 Ilmeisesti minulla ei ollu ladattuna kyseistä skriptiä, joten se ei lähtenyt toimimaan.

 Luin toisen blogipostauksen tästä: https://blog.smallsec.ca/nmap-scan-cheatsheet/

 Tässä käytettiin komentoa: --script-args joten koitin sitä

 Tämä näytti toimivan
 
 <img width="951" height="320" alt="image" src="https://github.com/user-attachments/assets/0318313f-a9e4-40da-b68e-1f8a529c6a0d" />

  Kuitenkin ngreppiin ilmestyi vain kyseinen rivi, eli jotain teen väärin.

  <img width="948" height="84" alt="image" src="https://github.com/user-attachments/assets/0d71f852-86e8-4ecb-9687-1543bdd40ac4" />

 Koitin montaa eri versiota kyseisestä skriptistä, mikään ei saanut user agenttia muokattua silleen että se näyttäisi weppiselaimelta. 

 Kävin katsomassa blogipostausta uudellee, siellä se oli useragent flagin jälkeen laittanut ="nimi"

 Yritin toistaa samaa

 Ajoin nmapin uudestaan muokatulla komennolla

 <img width="923" height="338" alt="image" src="https://github.com/user-attachments/assets/653042fb-2016-4648-92d7-a033bd831103" />

Wiresharkista tarkistin user-agentin

Tämä näyttäisi toimivan ok

<img width="696" height="748" alt="image" src="https://github.com/user-attachments/assets/af6e7102-2349-4fd8-aa5d-286e77de5fd1" />




 

  
  #  h) Pienemmät jäljet. Porttiskannaa weppipalvelimesi uudelleen localhost-osoitteella. Tarkastele sekä Apachen lokia että siepattua verkkoliikennettä. Mikä on muuttunut, kun vaihdoit user-agent:n? Löytyykö lokista edelleen tekstijono "nmap"?

  Navigoin takaisin /var/log/apache2 ja sieltä avasin logit tails komennolla

  Nmappia ei enää näkynyt listalla, sen sijaan siellä näkyi minun asettama user agentti 

  <img width="934" height="272" alt="image" src="https://github.com/user-attachments/assets/145ea4b2-46e2-4bd8-bc62-dccd083dbacc" />

Wiresharkissa kuitenkin näkyy edelleen tämä nmap rivi 

<img width="948" height="33" alt="image" src="https://github.com/user-attachments/assets/7b1eed28-8d15-4bf2-8b81-1b5b54b5b52d" />

Mutta kuten edellisessä tehtävässä todettu user agentti on muokaautunut.
  
<img width="858" height="289" alt="image" src="https://github.com/user-attachments/assets/d43d1ad6-4192-4c2d-be31-d4ba05d1fa4a" />

  
  #  i) Hieman vaikeampi: LoWeR ChEcK. Poista skritiskannauksesta viimeinenkin "nmap" -teksti. Etsi löytämääsi tekstiä /usr/share/nmap -hakemistosta ja korvaa se toisella. Tee porttiskannaus ja tarkista, että "nmap" ei näy isolla eikä pienellä kirjoitettuna Apachen lokissa eikä siepatussa verkkoliikenteessä. (Tässä tehtävässä voit muokata suoraan lua-skriptejä /usr/share/nmap alta, 'sudoedit'. Muokatun version paketoiminen siis rajataan ulos tehtävästä.)


  
  #  j) Vapaaehtoinen, vaikea: Invisible, invincible. Etsi jokin toinen nmap:n skripti, jonka verkkoliikenteessä esiintyy merkkijono "nmap" isolla tai pienellä. Muuta nmap:n koodia niin, että tuo merkkijono ei enää näy verkkoliikenteessä.

  Lähteet:

  https://nmap.org/nsedoc/scripts/http-useragent-tester.html
